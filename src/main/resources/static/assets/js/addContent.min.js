function getBlankSection(){return{id:"",sectionName:"",videos:[]}}function getBlankVideo(){return{id:"",videoTitle:"",videoSubtitle:"",videoURL:"",videoThumbnailURL:""}}function getDefaultDTO(){return{data:{course:{courseTitle:"",courseSubtitle:"",courseDescription:"",courseLanguage:"",courseLevel:"",courseCategory:"",courseSubCategory:"",courseWelcomeMessage:"",courseCongratulationsMessage:"",price:{amount:"",currency:""},sections:[]}}}}let DTO=getDefaultDTO(),coursePageCount=9,coursePageString="coursePage",coursePageButtonString="coursePageButton";for(let e=1;e<=coursePageCount;e++){let t=coursePageButtonString+e,o=coursePageString+e;document.getElementById(`${t}`).addEventListener("click",(function(){for(let e=1;e<=coursePageCount;e++){let t=coursePageString+e;displayElement(document.getElementById(t),!1)}displayElement(document.getElementById(o),!0)}),!1)}let oldCandidateSectionTitle,titleValidationPattern=/^([^!@#$%^&*().\.]+[^\'%$#^']+)$/,addContentButton=document.getElementById("addContentButton"),sectionPane=document.getElementById("addContentPane"),candidateSectionTitle=document.getElementById("newSectionTitle"),saveSectionButton=document.getElementById("addSectionButton"),cancelSectionButton=document.getElementById("cancelSectionButton"),warningSection=document.getElementById("newSectionWarning"),uploadVideoDialog=null,contentList=document.querySelector("#contents"),contentItem=document.querySelector("#content"),contentAddedVideos=document.getElementById("contentAddedVideos");const validVideoExtensions=["video/mp4","video/avi"],validImageExtensions=["image/jpeg","image/png","image/jpg"];let lastVideoLocalURL=null,uploadVideoDropArea=null,uploadVideoDragLabel=null,browseVideobutton=null,uploadVideoFileInput=null,uploadedVideoFile=null;function initializePage(){DTO=getDefaultDTO()}function getUploadVideoDialogExample(){return document.getElementById("uploadVideoDialog")}function getUploadVideoDialogBrowsePage(){return uploadVideoDialog.querySelector("#uploadVideoDialogPage")}function getUploadVideoDialogSpinner(){return uploadVideoDialog.querySelector("#uploadVideoSpinner")}function getUploadVideoDialogDetailsPage(){return uploadVideoDialog.querySelector("#videoDetailsDialogPage")}function getUploadVideoPreviewElement(){return uploadVideoDialog.querySelector("#uploadVideoPreview")}function displayElement(e,t){if(null!=e)t?(e==sectionPane&&(oldCandidateSectionTitle=candidateSectionTitle.value),e.classList.remove("hidden")):e.classList.add("hidden");else{console.trace();var o=new String;"global"==(o=arguments.callee.caller?arguments.callee.caller.name:"global")?alert(`displayElement(element=${e},${t}) called in global scope`):alert(`displayElement(element=${e},${t}) called from `+o+" function")}}function validateSectionTitle(e){let t=String(e).toLowerCase().match(titleValidationPattern);for(let o=0;o<DTO.data.course.sections.length;o++)DTO.data.course.sections[o].sectionName==e&&(t=null);if(null==t&&""!=e){displayElement(warningSection,!0);let t=e,o="";return o=t.replace(/\s/g,"").length?t:"Space",document.getElementById("newSectionWarningText").textContent=o+" is not applicable!",saveSectionButton.disabled=!0,null}return saveSectionButton.disabled=!1,displayElement(warningSection,!1),t}function updateContentList(){if(!(contentList.children.length<0)){for(let e=contentList.children.length-1;e>=1;e--)contentList.children[e].remove();for(let e=0;e<DTO.data.course.sections.length;e++){let t=contentItem.cloneNode(!0);t.id=t.id+e,displayElement(t,!0),t.querySelector("#sectionRownNumber").textContent="Section "+(e+1)+":",t.querySelector("#sectionTitleText").textContent=DTO.data.course.sections[e].sectionName;let o=t.querySelector("#addDropdown");o.id="VideoItemAdd"+e,o.querySelector("#addDropdownVideo").addEventListener("click",(t=>{displayUploadVideoDialogPage(e)}),!1);let n=t.querySelector("#modifySectionButton");n.id="modifyBtn"+e,n.addEventListener("click",(t=>{modifySection(e)}),!1);let i=t.querySelector("#deleteSectionButton");i.id="deleteBtn"+e,i.addEventListener("click",(t=>{removeSection(e)}),!1);for(let o=0;o<DTO.data.course.sections[e].videos.length;o++){let n=contentAddedVideos.cloneNode(!0);displayElement(n,!0);let i=document.createElement("source");i.setAttribute("src",DTO.data.course.sections[e].videos[o].videoURL),i.setAttribute("type","video/mp4");let l=n.querySelector("#contentVideoPlayer");l.setAttribute("poster",DTO.data.course.sections[e].videos[o].videoThumbnailURL),l.setAttribute("preload","none"),l.appendChild(i),n.querySelector("#contentVideoPlayerVideoTitle").textContent=o+1+". "+DTO.data.course.sections[e].videos[o].videoTitle,n.querySelector("#contentVideoPlayerVideoDescription").textContent=DTO.data.course.sections[e].videos[o].videoSubtitle,t.appendChild(n)}contentList.appendChild(t)}}}function requestSaveSection(e){if(null==validateSectionTitle(e))return!1;let t=-1;for(let e=0;e<DTO.data.course.sections.length;e++)if(DTO.data.course.sections[e].sectionName==oldCandidateSectionTitle){t=e;break}if(-1==t){let t=getBlankSection();t.sectionName=e,DTO.data.course.sections.push(t)}else DTO.data.course.sections[t].sectionName=e;return updateContentList(),!0}function modifySection(e){candidateSectionTitle.value=DTO.data.course.sections[e].sectionName,displayElement(sectionPane,!0)}function removeSection(e){e>DTO.data.course.sections.length-1||(DTO.data.course.sections.splice(e,1),updateContentList())}function displayUploadVideoDialogPage(e){uploadVideoDialog=getUploadVideoDialogExample().cloneNode(!0),document.body.insertBefore(uploadVideoDialog,document.body.firstChild),document.body.style.overflow="hidden",displayElement(uploadVideoDialog,!0),displayElement(getUploadVideoDialogBrowsePage(),!0),displayElement(getUploadVideoDialogDetailsPage(),!1),displayElement(getUploadVideoDialogSpinner(),!1),uploadVideoDropArea=document.querySelector(".drag-image"),uploadVideoDragLabel=uploadVideoDropArea.querySelector("h6"),browseVideobutton=uploadVideoDropArea.querySelector("button"),uploadVideoFileInput=uploadVideoDropArea.querySelector("input"),browseVideobutton.onclick=()=>{uploadVideoFileInput.click()},uploadVideoFileInput.addEventListener("change",(function(){uploadedVideoFile=this.files[0],onBrowseVideoSelected(e)})),uploadVideoDropArea.addEventListener("dragover",(e=>{e.preventDefault(),uploadVideoDragLabel.textContent="Release to Upload File"})),uploadVideoDropArea.addEventListener("dragleave",(()=>{uploadVideoDragLabel.textContent="Drag & Drop to Upload File"})),uploadVideoDropArea.addEventListener("drop",(t=>{t.preventDefault(),uploadedVideoFile=t.dataTransfer.files[0],onBrowseVideoSelected(e)}))}function onBrowseVideoSelected(e){if(validVideoExtensions.includes(uploadedVideoFile.type)){let t=new FileReader;displayElement(uploadVideoDialog,!0),displayElement(getUploadVideoDialogBrowsePage(),!1),displayElement(getUploadVideoDialogDetailsPage(),!1),displayElement(getUploadVideoDialogSpinner(),!0),t.onload=()=>{lastVideoLocalURL=t.result,requestAddVideoDetails(e)},t.readAsDataURL(uploadedVideoFile)}else alert("This file is not applicable!"),uploadVideoDragLabel.textContent="Drag & Drop to Upload File"}function doAPIcall(e,t,o,n){var i=new XMLHttpRequest;i.open("POST",t),i.setRequestHeader("Content-Type","application/json;charset=UTF-8"),i.onreadystatechange=function(){if(i.readyState==XMLHttpRequest.DONE&&200==i.status){var e=i.responseText;n&&n(e)}},i.send(JSON.stringify(getBlankVideo()))}function requestAddVideoDetails(e){let t,o=document.getElementById("uploadVideoButton"),n=document.getElementById("thumbnailFileInput"),i=null,l=document.createElement("source");l.setAttribute("src",lastVideoLocalURL),l.setAttribute("type","video/mp4"),getUploadVideoPreviewElement().setAttribute("preload","none"),getUploadVideoPreviewElement().appendChild(l),displayElement(uploadVideoDialog,!0),displayElement(getUploadVideoDialogBrowsePage(),!1),displayElement(getUploadVideoDialogSpinner(),!1),displayElement(getUploadVideoDialogDetailsPage(),!0),n.addEventListener("change",(function(){t=this.files[0],function(){let e=new FileReader;validImageExtensions.includes(t.type)?e.onload=()=>{i=e.result,document.getElementById("videoThumbnailImagePreview").src=i}:alert("This file is not applicable!");e.readAsDataURL(t)}()})),o.addEventListener("click",(t=>{let o=!0,n=document.getElementById("videoTitleText").value,l=document.getElementById("videoDescriptionText").value;if(null!=i&&null!=lastVideoLocalURL||(alert("urls null!"),o=!1),null!=n&&null!=l||(alert("texts null"),o=!1),0==o)alert("Please, fill in all of the required fields.");else{let t=getBlankVideo();t.id=DTO.data.course.sections[e].videos.length,t.videoTitle=n,t.videoSubtitle=l,t.videoURL=lastVideoLocalURL,t.videoThumbnailURL=i,DTO.data.course.sections[e].videos.push(t),doAPIcall("POST","http://localhost:8080/stoody/collections/videos/uploadVideo",t,(function(e){alert(e)})),closeUploadDialog(),updateContentList()}}),!1),getUploadVideoPreviewElement().pause()}function closeUploadDialog(){uploadVideoDialog.remove(),uploadVideoDialog=null,lastVideoLocalURL=null,uploadVideoDropArea=null,uploadVideoDragLabel=null,browseVideobutton=null,uploadVideoFileInput=null,uploadedVideoFile=null,document.body.style.overflow="visible"}initializePage(),addContentButton.addEventListener("click",(function(){displayElement(sectionPane,!0)}),!1),candidateSectionTitle.addEventListener("input",(e=>{validateSectionTitle(candidateSectionTitle.value)}),!1),saveSectionButton.addEventListener("click",(function(){0!=requestSaveSection(candidateSectionTitle.value)&&(candidateSectionTitle.value="",displayElement(sectionPane,!1))}),!1),cancelSectionButton.addEventListener("click",(function(){candidateSectionTitle.value="",displayElement(sectionPane,!1),displayElement(warningSection,!1)}),!1),displayElement(contentItem,!1),displayElement(contentAddedVideos,!1),displayElement(getUploadVideoDialogExample(),!1);